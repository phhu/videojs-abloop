{"version":3,"sources":["videojs-abloop.js","plugin.js"],"names":["module","exports","window","videojs","version","abLoopPlugin","initialOptions","player","isNumber","n","isNaN","parseFloat","isFinite","isFunction","functionToCheck","toString","call","toBoolean","x","formatTimeWithMS","seconds","decimalPlaces","formatTime","Math","floor","pow","roundFloat","f","parseTimeStamp","timestamp","undefined","test","res","exec","d","match","sign","hours","mins","secs","multiplier","totSecs","opts","optionSpecs","duration","callBackSpecs","optionNames","Object","keys","callBackNames","validateOptions","api","forEach","optName","validate","setOptionsToInitialOptions","setOptions","newOptions","replaceAll","alreadyPausedBeforeLoop","goToStartOfLoop","checkPause","pauseBeforeLooping","pause","currentTime","start","pauseAfterLooping","onLoopCallBack","check","timeSetter","time","timeAdjuster","adjustment","enableLoop","enabled","toggler","getUrlHash","spec","hash","end","getUrlWithHash","src","currentSrc","url","applyUrlHash","parseUrl","re","replace","getOptions","optionsToReturn","retOpts","sourceObject","newObject","cloneAndPluck","Array","isArray","key","notify","funcToRun","changed","defValue","args","arguments","oldOpts","ret","apply","optionDetails","onOptionsChange","updateButtonText","loopAtEndOfVideoRequired","loopRequired","curTime","endTime","startTime","getEndTime","getStartTime","loopIfAfterEnd","loopIfBeforeStart","isLooping","minLoopLength","checkABLoop","e","paused","setTimeout","buttons","buttonSpecs","event","shiftKey","adjustStart","ctrlKey","setStart","goToStart","adjustEnd","setEnd","goToEnd","prompt","applyUrl","inputPrompt","getAbsoluteUrl","altKey","getUrl","applyUrlFragment","getUrlFragment","toggle","msg","clipboardPrompt","cyclePauseOnLooping","message","def","createButtons","specs","name","clickFunction","defaultText","textFunction","abLoopCall","whichButton","which","updateText","b","controlBar","addChild","leftclick","on","rightclick","el","onmousedown","bind","preventDefault","stopPropagation","text","textContent","optionsUsed","addClass","createButton","changedReducer","acc","buttonName","reduce","resetToInitialOptions","enable","disable","togglePauseAfterLooping","togglePauseBeforeLooping","after","before","absoluteURL","document","div","createElement","innerHTML","firstChild","href","urlWithoutHash","urlHash","curSrc","playLoop","play","setToDefault","default","defaultInitialOptions","callBackName","ready","loop","loaded","registerPlugin","VERSION","plugin"],"mappings":"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","file":"videojs-abloop.min.js","sourceRoot":"..","sourcesContent":["/*\r\n * Video.js AB loop plugin\r\n * Adds function to allow looping for a section of a video in video.js player\r\n * https://github.com/phhu/videojs-abloop\r\n * MIT licence\r\n */\r\n\r\n // export default\r\n module.exports = function (window, videojs) {\r\n\r\n\tvar version = \"1.2.0\";\r\n\tvar abLoopPlugin = function (initialOptions) {\r\n\r\n\t\t//default initial options if not specified. \r\n\t\tinitialOptions = initialOptions || {};\r\n\t\t\r\n\t\t//get reference to player\r\n\t\tvar player = this;\r\n\r\n\t\t//utility functions\r\n\t\tvar isNumber = function (n) {\r\n\t\t\treturn !isNaN(parseFloat(n)) && isFinite(n);\r\n\t\t};\r\n\t\tvar isFunction = function (functionToCheck) {\r\n\t\t\tvar getType = {};\r\n\t\t\treturn functionToCheck && getType.toString.call(functionToCheck) === '[object Function]';\r\n\t\t};\r\n\t\tvar toBoolean = function (x) {\r\n\t\t\treturn !!x;\r\n\t\t};\r\n\t\tvar cloneAndPluck = function (sourceObject, keys) {\r\n\t\t\tvar newObject = {};\r\n\t\t\tkeys.forEach(function (key) {\r\n\t\t\t\tif (sourceObject[key] !== undefined) {\r\n\t\t\t\t\tnewObject[key] = sourceObject[key];\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn newObject;\r\n\t\t};\r\n\t\t//adds decimals to videojs's format time function\r\n\t\tvar formatTimeWithMS = function (seconds, decimalPlaces) {\r\n\t\t\tdecimalPlaces = decimalPlaces || 1;\r\n\t\t\treturn videojs.formatTime(seconds) + '.' + Math.floor((seconds % 1) * Math.pow(10, decimalPlaces));\r\n\t\t};\r\n\t\tvar roundFloat = function (n, decimalPlaces) {\r\n\t\t\tvar f = Math.pow(10, decimalPlaces);\r\n\t\t\treturn Math.floor(n * f) / f;\r\n\t\t};\r\n\r\n\t\t//this converts a timestamp (1h23, 1:23:33, 1m30s etc) to a number of seconds\r\n\t\tvar parseTimeStamp = function (timestamp) {\r\n\t\t\tif (timestamp === undefined) {\r\n\t\t\t\treturn undefined;\r\n\t\t\t}\r\n\t\t\t//if a plain number ,assume seconds\r\n\t\t\tif (isNumber(timestamp)) {\r\n\t\t\t\treturn timestamp;\r\n\t\t\t}\r\n\t\t\tif (/^([+\\-])?([\\d\\.]+)$/i.test(timestamp)) {\r\n\t\t\t\treturn parseFloat(timestamp);\r\n\t\t\t}\r\n\t\t\t//this assumes a plain whole number is minutes\r\n\t\t\tvar res = /^([+\\-])?((([\\d]+)(h|:(?=.*:)))?(([\\d]+)(m|:|$))?)?(([\\d\\.]+)s?)?$/i.exec(timestamp);\r\n\t\t\tif (!res) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\tvar d = {\r\n\t\t\t\tmatch: res[0],\r\n\t\t\t\tsign: res[1],\r\n\t\t\t\thours: res[4] || 0,\r\n\t\t\t\tmins: res[7] || 0,\r\n\t\t\t\tsecs: res[10] || 0\r\n\t\t\t};\r\n\t\t\tvar multiplier = (d.sign == '-') ? -1 : 1;\r\n\t\t\tvar totSecs = parseFloat(d.hours) * 60 * 60 + parseFloat(d.mins) * 60 + parseFloat(d.secs);\r\n\t\t\treturn isNumber(totSecs) ? multiplier * totSecs : null;\r\n\t\t};\r\n\r\n\t\t//contains options, allowing them to be set at runtime\r\n\t\tvar opts = {};\r\n\r\n\t\tvar optionSpecs = {\r\n\t\t\t'start': {\r\n\t\t\t\t\"default\": 0,\r\n\t\t\t\t\"validate\": function (x) {\r\n\t\t\t\t\tif (x === false) {\r\n\t\t\t\t\t\treturn x;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (isNumber(x) && x >= 0) {\r\n\t\t\t\t\t\treturn x;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'end': {\r\n\t\t\t\t\"default\": false,\r\n\t\t\t\t\"validate\": function (x) {\r\n\t\t\t\t\tif (x === false) {\r\n\t\t\t\t\t\treturn x;\r\n\t\t\t\t\t} //allow false values to mean loop til end\r\n\t\t\t\t\tif (isNumber(x)) {\r\n\t\t\t\t\t\tvar duration = player.duration();\r\n\t\t\t\t\t\tif (duration === 0 || !(isNumber(duration))) { //duration unknown\r\n\t\t\t\t\t\t\tif (x >= 0) {\r\n\t\t\t\t\t\t\t\treturn x;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else { //we know the duration\r\n\t\t\t\t\t\t\tif (x >= 0 && x <= duration) {\r\n\t\t\t\t\t\t\t\treturn x;\r\n\t\t\t\t\t\t\t} else if (x > duration) {\r\n\t\t\t\t\t\t\t\treturn duration;\r\n\t\t\t\t\t\t\t} else {    // shouldn't happen....\r\n\t\t\t\t\t\t\t\treturn x;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false; // by default, loop to end of video\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'enabled': {\r\n\t\t\t\t\"default\": false,\r\n\t\t\t\t\"validate\": toBoolean\r\n\t\t\t},\r\n\t\t\t'loopIfBeforeStart': {\r\n\t\t\t\t\"default\": true,\r\n\t\t\t\t\"validate\": toBoolean\r\n\t\t\t},\r\n\t\t\t'loopIfAfterEnd': {\r\n\t\t\t\t\"default\": true,\r\n\t\t\t\t\"validate\": toBoolean\r\n\t\t\t},\r\n\t\t\t'pauseBeforeLooping': {\r\n\t\t\t\t\"default\": false,\r\n\t\t\t\t\"validate\": toBoolean\r\n\t\t\t},\r\n\t\t\t'pauseAfterLooping': {\r\n\t\t\t\t\"default\": false,\r\n\t\t\t\t\"validate\": toBoolean\r\n\t\t\t}\r\n\t\t\t//it's easier not to treat this as an option, as can't remove buttons once created\r\n\t\t\t/*,'createButtons':{\r\n\t\t\t\"default\":true\r\n\t\t,\"validate\":toBoolean\r\n\t\t\t}*/\r\n\t\t};\r\n\r\n\t\t//callbacks can be included in initial options, but are not treated as options\r\n\t\t//check is used to check that the callbacks are valid, but not to replace their values\r\n\t\tvar callBackSpecs = {\r\n\t\t\t'onLoopCallBack': {\r\n\t\t\t\t\"default\": undefined,\r\n\t\t\t\t\"check\": isFunction\r\n\t\t\t},\r\n\t\t\t'onOptionsChange': {\r\n\t\t\t\t\"default\": undefined,\r\n\t\t\t\t\"check\": isFunction\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t//for convenience\r\n\t\tvar optionNames = Object.keys(optionSpecs);\r\n\t\tvar callBackNames = Object.keys(callBackSpecs);\r\n\r\n\t\t//set initial option values to defaults if they are not specified\r\n\t\tvar defaultInitialOptions = function () {\r\n\t\t\tinitialOptions = initialOptions || {};\r\n\r\n\t\t\tvar setToDefault = function (specs) {\r\n\t\t\t\treturn function (name) {\r\n\t\t\t\t\tif (initialOptions[name] === undefined) {\r\n\t\t\t\t\t\tinitialOptions[name] = specs[name].default;\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t};\r\n\t\t\toptionNames.forEach(setToDefault(optionSpecs));\r\n\t\t\tcallBackNames.forEach(setToDefault(callBackSpecs));\r\n\t\t};\r\n\r\n\t\t//assign bound copies of the callbacks to the api\r\n\t\tvar setCallBacksToInitialOptions = function () {\r\n\t\t\tcallBackNames.forEach(function (callBackName) {\r\n\t\t\t\tif (callBackSpecs[callBackName].check(initialOptions[callBackName])) {\r\n\t\t\t\t\tapi[callBackName] = initialOptions[callBackName]; // .bind(api) - better not to bind\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t//check that the options make sense. This is called on timeupdate, before the main logic.\r\n\t\t//so nonsense options will persist as long as time does not update\r\n\t\tvar validateOptions = function () {\r\n\t\t\toptionNames.forEach(function (optName) {\r\n\t\t\t\topts[optName] = optionSpecs[optName].validate(opts[optName]);\r\n\t\t\t});\r\n\t\t\treturn api;\r\n\t\t};\r\n\r\n\t\tvar setOptionsToInitialOptions = function () {\r\n\t\t\treturn setOptions(initialOptions, true);\r\n\t\t};\r\n\r\n\t\tvar setOptions = function (newOptions, replaceAll) {\r\n\r\n\t\t\toptionNames.forEach(function (optName) {\r\n\t\t\t\tif (replaceAll || newOptions[optName] !== undefined) {\r\n\t\t\t\t\topts[optName] = newOptions[optName];\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tvalidateOptions();\r\n\t\t\treturn api;\r\n\t\t};\r\n\r\n\t\tvar alreadyPausedBeforeLoop = false; //if we pause before looping, need to know if it has already been done so that we can then loop\r\n\t\t//this sets the player to the start of the loop\r\n\t\tvar goToStartOfLoop = function (checkPause) {\r\n\r\n\t\t\tif (checkPause) {\r\n\t\t\t\tif (opts.pauseBeforeLooping && alreadyPausedBeforeLoop === false) {\r\n\t\t\t\t\tplayer.pause();\r\n\t\t\t\t\talreadyPausedBeforeLoop = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\talreadyPausedBeforeLoop = false;\r\n\r\n\t\t\t\t\t//do loop\r\n\t\t\t\t\tplayer.currentTime(opts.start);\r\n\t\t\t\t\t//invoke callback if set\r\n\t\t\t\t\tif (opts.pauseAfterLooping) {\r\n\t\t\t\t\t\tplayer.pause();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (callBackSpecs.onLoopCallBack.check(api.onLoopCallBack)) {\r\n\t\t\t\t\t\tapi.onLoopCallBack(api, player);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\talreadyPausedBeforeLoop = false;\r\n\t\t\t\tplayer.currentTime(opts.start);\r\n\t\t\t}\r\n\t\t\treturn api;\r\n\t\t};\r\n\r\n\t\tvar goToEndOfLoop = function () {\r\n\t\t\talreadyPausedBeforeLoop = false;\r\n\t\t\tplayer.currentTime(opts.end);\r\n\t\t\treturn api;\r\n\t\t};\r\n\r\n\t\t//makes a function to set a time option (start,end)\r\n\t\tvar timeSetter = function (optName) {\r\n\t\t\treturn function (time) {\r\n\t\t\t\tif (time === false) {\r\n\t\t\t\t\topts[optName] = false;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (time !== undefined) {\r\n\t\t\t\t\t\ttime = parseTimeStamp(time);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (time !== null) {\r\n\t\t\t\t\t\ttime = (time === undefined) ? player.currentTime() : time;\r\n\t\t\t\t\t\topts[optName] = time;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn api;\r\n\t\t\t};\r\n\t\t};\r\n\r\n\t\t//makes a function to change a time option\r\n\t\tvar timeAdjuster = function (optName) {\r\n\t\t\treturn function (adjustment) {\r\n\t\t\t\tadjustment = parseTimeStamp(adjustment);\r\n\t\t\t\tif (isNumber(adjustment)) {\r\n\t\t\t\t\topts[optName] += adjustment;\r\n\t\t\t\t}\r\n\t\t\t\treturn api;\r\n\t\t\t};\r\n\t\t};\r\n\r\n\t\tvar playLoop = function () {\r\n\t\t\tvalidateOptions();\r\n\t\t\tgoToStartOfLoop(false);\r\n\t\t\tenableLoop();\r\n\t\t\tplayer.play();\r\n\t\t\treturn api;\r\n\t\t};\r\n\r\n\t\tvar enableLoop = function () {\r\n\t\t\topts.enabled = true;\r\n\t\t\treturn api;\r\n\t\t};\r\n\t\tvar disableLoop = function () {\r\n\t\t\topts.enabled = false;\r\n\t\t\treturn api;\r\n\t\t};\r\n\t\tvar cyclePauseOnLooping = function () {\r\n\t\t\tvar after = opts.pauseAfterLooping,\r\n\t\t\tbefore = opts.pauseBeforeLooping;\r\n\t\t\tif (!after && !before) {\r\n\t\t\t\tsetOptions({\r\n\t\t\t\t\tpauseAfterLooping: true,\r\n\t\t\t\t\tpauseBeforeLooping: false\r\n\t\t\t\t});\r\n\t\t\t} else if (after && !before) {\r\n\t\t\t\tsetOptions({\r\n\t\t\t\t\tpauseAfterLooping: false,\r\n\t\t\t\t\tpauseBeforeLooping: true\r\n\t\t\t\t});\r\n\t\t\t} else if (!after && before) {\r\n\t\t\t\tsetOptions({\r\n\t\t\t\t\tpauseAfterLooping: true,\r\n\t\t\t\t\tpauseBeforeLooping: true\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tsetOptions({\r\n\t\t\t\t\tpauseAfterLooping: false,\r\n\t\t\t\t\tpauseBeforeLooping: false\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\treturn api;\r\n\t\t};\r\n\r\n\t\t//return a function to toggle an option\r\n\t\tvar toggler = function (optName) {\r\n\t\t\treturn function () {\r\n\t\t\t\topts[optName] = !opts[optName];\r\n\t\t\t\treturn api;\r\n\t\t\t};\r\n\t\t};\r\n\r\n\t\t//borrowed from videojs library (private method)\r\n\t\tvar absoluteURL = function (url) {\r\n\t\t\t// Check if absolute URL\r\n\t\t\tif (!url.match(/^https?:\\/\\//)) {\r\n\t\t\t\t// Convert to absolute URL.\r\n\t\t\t\tif (window && window.document) {\r\n\t\t\t\t\tvar div = window.document.createElement('div');\r\n\t\t\t\t\tdiv.innerHTML = '<a href=\"' + url + '\">x</a>';\r\n\t\t\t\t\turl = div.firstChild.href;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn url;\r\n\t\t};\r\n\r\n\t\tvar getAbsoluteUrlWithHash = function (spec) {\r\n\t\t\treturn absoluteURL(getUrlWithHash(spec));\r\n\t\t};\r\n\r\n\t\t//return a URL hash / fragment describing the looped portion.\r\n\t\t//e.g. #t=10,12  - see https://www.w3.org/TR/media-frags/#standardisation-URI-fragments\r\n\t\tvar getUrlHash = function (spec) {\r\n\t\t\tspec = spec || {};\r\n\t\t\tspec.decimalPlaces = Math.floor(spec.decimalPlaces) || 3;\r\n\r\n\t\t\t//validateOptions();\r\n\r\n\t\t\tvar start = (opts.start !== false) ? parseFloat(opts.start) : 0;\r\n\t\t\tvar hash = '#' + 't=' + roundFloat(start, spec.decimalPlaces);\r\n\r\n\t\t\tif (opts.end !== false) {\r\n\t\t\t\tvar end = parseFloat(opts.end);\r\n\t\t\t\thash += (',' + roundFloat(end, spec.decimalPlaces));\r\n\t\t\t}\r\n\t\t\treturn hash;\r\n\r\n\t\t};\r\n\r\n\t\t//get a URL with a hash to identify the looping section\r\n\t\tvar getUrlWithHash = function (spec) {\r\n\t\t\tspec = spec || {};\r\n\r\n\t\t\tvar src = player.currentSrc();\r\n\t\t\tif (src.src) {\r\n\t\t\t\tsrc = src.src;\r\n\t\t\t}\r\n\t\t\tvar url = src + getUrlHash(spec);\r\n\r\n\t\t\treturn url;\r\n\r\n\t\t};\r\n\t\t//apply just a hash, effectively setting start and end options\r\n\t\tvar applyUrlHash = function (url) {\r\n\r\n\t\t\t//allow to pass in a string or an object with hash property\r\n\t\t\tif (typeof url === 'string') {\r\n\t\t\t\turl = videojs.parseUrl(url);\r\n\t\t\t}\r\n\t\t\tif (url.hash) {\r\n\t\t\t\t//extract out the start and end times\r\n\t\t\t\tvar re = /^(#?t=)?([^,]*)(,(.*))?$/;\r\n\t\t\t\tvar start = url.hash.replace(re, '$2');\r\n\t\t\t\tvar end = url.hash.replace(re, '$4');\r\n\r\n\t\t\t\t//normally only seconds or hh:mm:ss are allowed, but allow 1m20s etc\r\n\t\t\t\tstart = parseTimeStamp(start);\r\n\t\t\t\tend = parseTimeStamp(end);\r\n\r\n\t\t\t\tif (isNumber(start)) {\r\n\t\t\t\t\topts.start = parseFloat(start);\r\n\t\t\t\t}\r\n\t\t\t\tif (isNumber(end)) {\r\n\t\t\t\t\topts.end = parseFloat(end);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn api;\r\n\t\t};\r\n\t\t//apply a url, typically with a hash to identify a section to loop\r\n\t\t//this will load a new source if necessary\r\n\t\tvar applyUrl = function (url) {\r\n\r\n\t\t\t//could use videojs.parseUrl, but regexping is less hassle\r\n\t\t\tvar urlWithoutHash = url.replace(/^(.*?)(#.*)?$/, '$1');\r\n\t\t\tvar urlHash = url.replace(/^(.*?)(#.*)?$/, '$2');\r\n\r\n\t\t\t//check if we need to update the source\r\n\t\t\tvar curSrc = player.currentSrc();\r\n\t\t\tif (!(curSrc == urlWithoutHash || curSrc == url || url == urlHash)) {\r\n\t\t\t\tplayer.src(urlWithoutHash);\r\n\t\t\t}\r\n\t\t\t//apply hash if there is one\r\n\t\t\tif (urlHash) {\r\n\t\t\t\tapplyUrlHash(urlHash);\r\n\t\t\t}\r\n\r\n\t\t\treturn api;\r\n\r\n\t\t};\r\n\r\n\t\tvar getOptions = function (optionsToReturn) {\r\n\r\n\t\t\tvar retOpts = optionsToReturn;\r\n\r\n\t\t\t//coerce retOpts into an Array\r\n\t\t\tif (typeof optionsToReturn === 'string') {\r\n\t\t\t\tretOpts = [optionsToReturn];\r\n\t\t\t} else if (optionsToReturn === undefined || !Array.isArray(optionsToReturn)) {\r\n\t\t\t\tif (optionsToReturn !== null && typeof optionsToReturn === 'object') {\r\n\t\t\t\t\t//allow specification with an object`\r\n\t\t\t\t\tretOpts = Object.keys(optionsToReturn);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//return all options if none are specified\r\n\t\t\t\t\tretOpts = Object.keys(optionSpecs);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn cloneAndPluck(opts, retOpts);\r\n\r\n\t\t};\r\n\r\n\t\t//used to add notification to a function call\r\n\t\t//changed is an object of properties which have changed\r\n\t\t//e.g. {'start':true, 'end':false}\r\n\t\tvar notify = function (funcToRun, changed) {\r\n\t\t\tvar defValue = changed ? false : true; //if changed not specified, assume they all have\r\n\t\t\tchanged = changed || {};\r\n\r\n\t\t\t//set defaults for changed\r\n\t\t\toptionNames.forEach(function (optName) {\r\n\t\t\t\tchanged[optName] = !!changed[optName] || defValue;\r\n\t\t\t});\r\n\r\n\t\t\treturn function () {\r\n\t\t\t\tvar args = arguments;\r\n\t\t\t\tvar oldOpts = getOptions(); //copy options as were\r\n\t\t\t\tvar ret = funcToRun.apply(null, args);\r\n\t\t\t\tvar optionDetails = {\r\n\t\t\t\t\t'changed': changed,\r\n\t\t\t\t\t'oldOpts': oldOpts,\r\n\t\t\t\t\t'newOpts': getOptions()\r\n\t\t\t\t};\r\n\t\t\t\tif (api.onOptionsChange) {\r\n\t\t\t\t\tapi.onOptionsChange(optionDetails, api, player);\r\n\t\t\t\t}\r\n\t\t\t\tupdateButtonText(changed); //API might have changed settings, so update the buttons\r\n\t\t\t\treturn ret;\r\n\t\t\t};\r\n\t\t};\r\n\r\n\t\tvar loopAtEndOfVideoRequired = false; //flag set to true if looping around end of video is requierd (where start > end)\r\n\t\tvar startMargin = 0.5; //sometimes the video will go to a point just before the loop (rounding), so allow a small margin on the start position check.\r\n\t\tvar endMargin = 1; //sometimes the video will go to a point just before the loop (rounding), so allow a small margin on the start position check.\r\n\t\t//given the current player state and options, should we loop?\r\n\t\tvar loopRequired = function () {\r\n\t\t\tvar curTime,\r\n\t\t\tendTime,\r\n\t\t\tstartTime;\r\n\r\n\t\t\tvalidateOptions();\r\n\r\n\t\t\tcurTime = player.currentTime();\r\n\t\t\tendTime = getEndTime();\r\n\t\t\tstartTime = getStartTime();\r\n\r\n\t\t\tif (startTime > endTime) {\r\n\t\t\t\tloopAtEndOfVideoRequired = true;\r\n\t\t\t\t//if the end is before the start, deal with it\r\n\t\t\t\tif (curTime < (startTime - startMargin) && curTime > endTime && ((curTime - endTime) < endMargin || opts.loopIfAfterEnd || opts.loopIfBeforeStart)) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t} else { //startTime <= endTime\r\n\t\t\t\tloopAtEndOfVideoRequired = false;\r\n\t\t\t\tif (curTime < (startTime - startMargin) && opts.loopIfBeforeStart) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t} else if (curTime >= endTime) {\r\n\t\t\t\t\t//use a margin of one just in case time has skipped a bit past\r\n\t\t\t\t\tif ((curTime - endTime) < endMargin || opts.loopIfAfterEnd) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t};\r\n\r\n\t\tvar getStartTime = function () {\r\n\t\t\treturn (opts.start === false) ? 0 : opts.start;\r\n\t\t};\r\n\t\tvar getEndTime = function () {\r\n\t\t\treturn (opts.end === false) ? player.duration() : opts.end;\r\n\t\t};\r\n\t\tvar isLooping = false;\r\n\t\tvar minLoopLength = (isNumber(initialOptions.minLoopLength) && initialOptions.minLoopLength > 0) ? initialOptions.minLoopLength : 200;\r\n\t\t//function run on time update by player\r\n\t\tvar checkABLoop = function (e) {\r\n\t\t\tif (!isLooping && opts.enabled && !player.paused() && loopRequired()) {\r\n\t\t\t\t//prevents constant looping\r\n\t\t\t\t/*if (getStartTime() === getEndTime()){\r\n\t\t\t\tplayer.pause();\r\n\t\t\t\t}*/\r\n\t\t\t\t//prevent looping happening to quickly in succession\r\n\t\t\t\t//this effectively sets a minimum loop time\r\n\t\t\t\t//if start time and end time are the same, we would get a loop of this length\r\n\t\t\t\tisLooping = true;\r\n\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\tisLooping = false;\r\n\t\t\t\t}, minLoopLength);\r\n\t\t\t\tgoToStartOfLoop(true);\r\n\t\t\t}\r\n\t\t};\r\n\t\t// BUTTON THINGS\r\n\t\tvar buttons = {}; //holds references to the button objects\r\n\r\n\t\tvar buttonSpecs = [{\r\n\t\t\t\t'name': 'start',\r\n\t\t\t\t'optionsUsed': ['start'],\r\n\t\t\t\t'leftclick': function (api, event) {\r\n\t\t\t\t\tif (event.shiftKey) {\r\n\t\t\t\t\t\tapi.adjustStart(-0.5);\r\n\t\t\t\t\t} else if (event.ctrlKey) {\r\n\t\t\t\t\t\tapi.adjustStart(-0.05);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tapi.setStart();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t'rightclick': function (api, event) {\r\n\t\t\t\t\tif (event.shiftKey) {\r\n\t\t\t\t\t\tapi.adjustStart(0.5);\r\n\t\t\t\t\t} else if (event.ctrlKey) {\r\n\t\t\t\t\t\tapi.adjustStart(0.05);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tapi.goToStart();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t'defaultText': 'Start',\r\n\t\t\t\t'textFunction': function (opts) {\r\n\t\t\t\t\treturn formatTimeWithMS(opts.start);\r\n\t\t\t\t}\r\n\t\t\t}, {\r\n\t\t\t\t'name': 'end',\r\n\t\t\t\t'optionsUsed': ['end'],\r\n\t\t\t\t'leftclick': function (api, event) {\r\n\t\t\t\t\tif (event.shiftKey) {\r\n\t\t\t\t\t\tapi.adjustEnd(-0.5);\r\n\t\t\t\t\t} else if (event.ctrlKey) {\r\n\t\t\t\t\t\tapi.adjustEnd(-0.05);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tapi.setEnd();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t'rightclick': function (api, event) {\r\n\t\t\t\t\tif (event.shiftKey) {\r\n\t\t\t\t\t\tapi.adjustEnd(0.5);\r\n\t\t\t\t\t} else if (event.ctrlKey) {\r\n\t\t\t\t\t\tapi.adjustEnd(0.05);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tapi.goToEnd();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t'defaultText': 'End',\r\n\t\t\t\t'textFunction': function (opts) {\r\n\t\t\t\t\treturn formatTimeWithMS(opts.end);\r\n\t\t\t\t}\r\n\t\t\t}, {\r\n\t\t\t\t'name': 'enabled',\r\n\t\t\t\t'optionsUsed': ['enabled', 'pauseAfterLooping', 'pauseBeforeLooping'],\r\n\t\t\t\t'leftclick': function (api, event) {\r\n\t\t\t\t\tvar msg,\r\n\t\t\t\t\turl;\r\n\t\t\t\t\tif (window && window.prompt) {\r\n\t\t\t\t\t\tif (event.ctrlKey) {\r\n\t\t\t\t\t\t\tapi.applyUrl(inputPrompt(\"Set new URL\", api.getAbsoluteUrl()));\r\n\t\t\t\t\t\t} else if (event.altKey) {\r\n\t\t\t\t\t\t\tapi.applyUrl(inputPrompt(\"Set new URL\", api.getUrl()));\r\n\t\t\t\t\t\t} else if (event.shiftKey) {\r\n\t\t\t\t\t\t\tapi.applyUrlFragment(inputPrompt(\"Set new URL fragment\", api.getUrlFragment()));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tapi.toggle();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tapi.toggle();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t'rightclick': function (api, event) {\r\n\t\t\t\t\tvar msg;\r\n\t\t\t\t\tif (window && window.prompt) {\r\n\t\t\t\t\t\tif (event.ctrlKey) {\r\n\t\t\t\t\t\t\tmsg = api.getAbsoluteUrl();\r\n\t\t\t\t\t\t} else if (event.altKey) {\r\n\t\t\t\t\t\t\tmsg = api.getUrl();\r\n\t\t\t\t\t\t} else if (event.shiftKey) {\r\n\t\t\t\t\t\t\tmsg = api.getUrlFragment();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (msg) {\r\n\t\t\t\t\t\tclipboardPrompt(msg);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tapi.cyclePauseOnLooping();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t'defaultText': 'Loop',\r\n\t\t\t\t'textFunction': function (opts) {\r\n\t\t\t\t\tif (opts.enabled) {\r\n\t\t\t\t\t\tif (opts.pauseBeforeLooping && opts.pauseAfterLooping) {\r\n\t\t\t\t\t\t\treturn 'PAUSE LOOP PAUSE';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (opts.pauseAfterLooping) {\r\n\t\t\t\t\t\t\treturn 'LOOP& PAUSE';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (opts.pauseBeforeLooping) {\r\n\t\t\t\t\t\t\treturn 'PAUSE &LOOP';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn 'LOOP ON';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn 'Loop off';\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t];\r\n\t\tvar clipboardPrompt = function (msg) {\r\n\t\t\tif (window && window.prompt) {\r\n\t\t\t\twindow.prompt(\"Copy to clipboard: Ctrl+C, Enter\", msg);\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar inputPrompt = function (message, def) {\r\n\t\t\tif (window && window.prompt) {\r\n\t\t\t\treturn window.prompt(message, def);\r\n\t\t\t} else {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar createButton = function (spec, player) {\r\n\t\t\t//returns a function which handles button clicks,\r\n\t\t\tvar clickFunction = function (abLoopCall, whichButton) {\r\n\t\t\t\treturn function (event) {\r\n\t\t\t\t\tif (whichButton === undefined || (event.which && event.which == whichButton)) {\r\n\t\t\t\t\t\tabLoopCall(player.abLoopPlugin, event);\r\n\t\t\t\t\t\tthis.updateText();\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t};\r\n\r\n\t\t\t//returns a function which handles button text updates\r\n\t\t\tvar updateTextFunction = function (defaultText, textFunction) {\r\n\t\t\t\treturn function () {\r\n\t\t\t\t\tvar text = textFunction(opts) || defaultText;\r\n\t\t\t\t\tvar el = this.el();\r\n\t\t\t\t\tel.textContent = text;\r\n\t\t\t\t\t//el.innerText = text;    //doesn't work in Firefox\r\n\t\t\t\t};\r\n\t\t\t};\r\n\r\n\t\t\t//create the button\r\n\t\t\tvar b = player.controlBar.addChild('Button');\r\n\t\t\tif (spec.leftclick) {\r\n\t\t\t\tb.on('click', clickFunction(spec.leftclick));\r\n\t\t\t}\r\n\t\t\tif (spec.rightclick) {\r\n\t\t\t\t//event which\r\n\t\t\t\t//bind the function as it isn't bound by default\r\n\t\t\t\tb.el().onmousedown = clickFunction(spec.rightclick, 3).bind(b);\r\n\t\t\t\t//knock out the context menu\r\n\t\t\t\tb.on('contextmenu', function (event) {\r\n\t\t\t\t\tif (event.preventDefault) {\r\n\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (event.preventDefault) {\r\n\t\t\t\t\t\tevent.stopPropagation();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t//gets called when text on button needs updating\r\n\t\t\tb.updateText = updateTextFunction(spec.defaultText, spec.textFunction);\r\n\t\t\tb.optionsUsed = spec.optionsUsed;\r\n\t\t\tb.addClass('abLoopButton');\r\n\t\t\tb.addClass(spec.name);\r\n\t\t\tb.updateText(); //set the initial text\r\n\t\t\treturn b;\r\n\t\t};\r\n\r\n\t\t//create the buttons based on the specs\r\n\t\tvar createButtons = function (specs) {\r\n\t\t\tspecs.forEach(function (spec) {\r\n\t\t\t\t//only create the button if it's not already there\r\n\t\t\t\tif (buttons[spec.name] === undefined) {\r\n\t\t\t\t\tbuttons[spec.name] = createButton(spec, player);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t//updates button displays if not already done\r\n\t\tvar updateButtonText = function (changed) {\r\n\t\t\tvar changedReducer = function (acc, optName) {\r\n\t\t\t\treturn acc || changed[optName];\r\n\t\t\t};\r\n\t\t\tfor (var buttonName in buttons) {\r\n\t\t\t\tvar b = buttons[buttonName];\r\n\t\t\t\tvar needsUpdate = !(b.optionsUsed) || b.optionsUsed.reduce(changedReducer, false);\r\n\t\t\t\tif (needsUpdate) {\r\n\t\t\t\t\tb.updateText();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t//functions etc to expose as API\r\n\t\t//those which change values can be passed through the notify function\r\n\t\tvar api = {\r\n\t\t\tvalidateOptions: notify(validateOptions),\r\n\t\t\tresetToInitialOptions: notify(setOptionsToInitialOptions),\r\n\t\t\tsetOptions: notify(setOptions),\r\n\t\t\tgetOptions: getOptions,\r\n\t\t\tgoToStart: goToStartOfLoop,\r\n\t\t\tgoToEnd: goToEndOfLoop,\r\n\t\t\tsetStart: notify(timeSetter('start'), {\r\n\t\t\t\t'start': true\r\n\t\t\t}),\r\n\t\t\tsetEnd: notify(timeSetter('end'), {\r\n\t\t\t\t'end': true\r\n\t\t\t}),\r\n\t\t\tadjustStart: notify(timeAdjuster('start'), {\r\n\t\t\t\t'start': true\r\n\t\t\t}),\r\n\t\t\tadjustEnd: notify(timeAdjuster('end'), {\r\n\t\t\t\t'end': true\r\n\t\t\t}),\r\n\t\t\tenable: notify(enableLoop, {\r\n\t\t\t\t'enabled': true\r\n\t\t\t}),\r\n\t\t\tdisable: notify(disableLoop, {\r\n\t\t\t\t'enabled': true\r\n\t\t\t}),\r\n\t\t\ttoggle: notify(toggler('enabled'), {\r\n\t\t\t\t'enabled': true\r\n\t\t\t}),\r\n\t\t\ttogglePauseAfterLooping: notify(toggler('pauseAfterLooping'), {\r\n\t\t\t\t'pauseAfterLooping': true\r\n\t\t\t}),\r\n\t\t\ttogglePauseBeforeLooping: notify(toggler('pauseBeforeLooping'), {\r\n\t\t\t\t'pauseBeforeLooping': true\r\n\t\t\t}),\r\n\t\t\tcyclePauseOnLooping: notify(cyclePauseOnLooping, {\r\n\t\t\t\t'pauseBeforeLooping': true,\r\n\t\t\t\t'pauseAfterLooping': true\r\n\t\t\t}),\r\n\t\t\tplayer: player,\r\n\t\t\tversion: version,\r\n\t\t\tgetAbsoluteUrl: getAbsoluteUrlWithHash,\r\n\t\t\tgetUrl: getUrlWithHash,\r\n\t\t\tgetUrlFragment: getUrlHash,\r\n\t\t\tapplyUrl: notify(applyUrl, {\r\n\t\t\t\t'start': true,\r\n\t\t\t\t'end': true\r\n\t\t\t}),\r\n\t\t\tapplyUrlFragment: notify(applyUrlHash, {\r\n\t\t\t\t'start': true,\r\n\t\t\t\t'end': true\r\n\t\t\t}),\r\n\t\t\tloopRequired: loopRequired //allows testing of conditions via API when player is paused\r\n\t\t,\r\n\t\t\tplayLoop: notify(playLoop)\r\n\t\t};\r\n\r\n\t\t//set up the plugin\r\n\t\tvar setup = function () {\r\n\r\n\t\t\tdefaultInitialOptions();\r\n\r\n\t\t\tsetCallBacksToInitialOptions();\r\n\r\n\t\t\t//set options to initial options and notify of change\r\n\t\t\tnotify(setOptionsToInitialOptions)();\r\n\r\n\t\t\tplayer.ready(function () {\r\n\t\t\t\t//create buttons once the player is ready\r\n\t\t\t\tif (initialOptions.createButtons != false) {\r\n\t\t\t\t\tcreateButtons(buttonSpecs);\r\n\t\t\t\t}\r\n\t\t\t\t//if start time is greater than end, the video needs to loop on ending\r\n\t\t\t\t//this is indicated by the loopAtEndOfVideoRequired flag\r\n\t\t\t\tplayer.on('ended', function () {\r\n\t\t\t\t\tif (loopAtEndOfVideoRequired && opts.enabled && !player.loop()) {\r\n\t\t\t\t\t\tplayer.play();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t//this replaces the reference created to this function on each player object\r\n\t\t\t//with a reference to the api object (created once per invocation of this function)\r\n\t\t\t//The functions created in this function and referenced by api will still\r\n\t\t\t//be available via closure\r\n\t\t\tplayer.abLoopPlugin = api;\r\n\r\n\t\t\t//on timeupdate, check if we need to loop\r\n\t\t\tplayer.on('timeupdate', checkABLoop);\r\n\t\t\tapi.loaded = true;\r\n\t\t};\r\n\r\n\t\tsetup();\r\n\t\treturn api;\r\n\t};\r\n\r\n\tabLoopPlugin.loaded = false;\r\n\tabLoopPlugin.VERSION = version;\r\n\r\n\tvar registerPlugin = videojs.registerPlugin || videojs.plugin;\r\n\treturn registerPlugin('abLoopPlugin', abLoopPlugin);\r\n\r\n};\r\n","// this file used to build the file for distribution \r\n// and so use directly in the browser\r\n\r\n// videojs is an external dependency - see package.json\r\n//import videojs from 'video.js' \r\nimport abLoopPlugin from './videojs-abloop'   \r\n\r\nabLoopPlugin(window,videojs);\r\n"]}